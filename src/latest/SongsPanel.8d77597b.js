import{g as e,y as t,i as s,m as n,_ as r,e as i}from"./preact.f8a34c73.js";import{u as o,be as l,bf as a,bg as c,bh as m,bi as u,bj as d,bk as f,bl as g,bm as p,p as h,q as b,bn as S}from"./index.3637aaf7.js";import{I as v,_ as F,k as j,$ as y,A as I,S as N,K as k}from"./SongsPanel.module.a5a30510.js";import{c as x}from"./SongsItem.fb125318.js";import{r as w}from"./SearchBox.b79cb4b8.js";import{e as C}from"./Stub.d042d44f.js";import{n as P}from"./ActionButton.e7edc72b.js";import{w as A}from"./Panel.4e04b14d.js";import"./DifficultyIndicator.c7b5f0f9.js";import"./ShowroomPlaceholder.module.29a59946.js";const D="IntersectionObserver"in window,T=e((e=>{let{route:T,user:B,device:M,isSmallScreen:O,id:E}=e;const{dispatch:R,songs:$,meta:q}=o("songs","meta");t((()=>l({route:T,songs:$,device:M})),[$.pattern,$.filters]);const z=s(),L=s();v(z,L,"SongsPanel");const{isDesktop:V}=M,{hasPlus:W}=B,_=$.songs.pattern.length>0,G=a($.filters,""),H=""!==G?` ${G}`:"",[J,K]=n($.pattern),Q=s(),U=r((()=>e=>{clearTimeout(Q.current),K(e);const t=e.replace(/\s+/g," ").trim();c(t);const s=()=>R("songs/filter/pattern",t);""===t?s():Q.current=setTimeout(s,500)}),[K]),X=()=>{p(S),R("songs/filter/reset")},[Y,Z]=n(null),ee=$.songs.list||[],te=0===$.pattern.length&&0===ee.length,se=m($.filters.instrument),ne=m($.songs.filters.instrument),re=0===$.pattern.length?{}:{pattern:$.pattern},ie=u.map((e=>d("/",e,re))),oe=f($.songs.filters),le=$.songs.hasMore&&!te,ae=s();t((()=>{try{if(ae.current&&D){const e=new IntersectionObserver((e=>{e[0].isIntersecting&&R("songs/more")}),{rootMargin:"0px 0px 300px 0px",threshold:1,root:document.getElementById("panel-search")});return e.observe(ae.current),()=>e.disconnect()}}catch(e){console.error(e)}}),[]);const ce={tuningFilter:$.filters.tunings[$.filters.instrument]||g,instrumentFilter:$.filters.instrument,difficultyFilter:$.filters.difficulty,setTuningFilter:e=>R("songs/filter/tuning",{instrument:$.filters.instrument,tuning:e}),setInstrumentFilter:e=>{p(e),R("songs/filter/instrument",e)},setDifficultyFilter:e=>R("songs/filter/difficulty",e),difficultyFilterNA:se,spacerSize:_?"normal":"big",numberSpacer:!_,isSmallScreen:O,instrumentSEOLinks:ie,activeFilter:Y,onFilterClick:e=>Z(e===Y?null:e)};return i(A,{title:`Search${H} Tabs`,id:E,styles:F,onClick:()=>Z(null),children:[i(j,{children:[i("div",{className:F.searchContainer,children:[i(w,{value:J,setValue:U,isDesktop:V,loading:!!$.loading,inputRef:L,placeholder:"Search over 500,000 tabs"})]}),i(y,ce),V&&!W&&i(I,{page:T.page,instrumentFilter:$.filters.instrument})]}),!te&&ee.length>0&&i("div",{className:F.songs,"data-list":"songs",ref:z,children:ee.map((e=>i(x,{song:e,isActive:q&&q.songId===e.songId,numerated:!_,difficultyNA:ne},e.songId.toString())))}),!D&&$.songs.hasMore&&i("div",{className:F.button,children:i(P,{onClick:()=>R("songs/more"),title:"Show more",processing:!!$.loading})}),D&&i("div",{ref:ae,children:[le&&!!$.loading&&i(h,{fill:"#777",width:35,height:35,className:b.songs})]}),!te&&0===ee.length&&i("div",{className:F.stubWrapper,children:[i(C,{id:"notfound",header:"No tabs found",headerColor:"red",icon:()=>i(N,{}),children:i(k,{usesFilters:oe,numResults:0,resetFilter:oe?X:()=>{X(),U("")}})})]})]})}));export{T as default};
//# sourceMappingURL=SongsPanel.8d77597b.js.map
