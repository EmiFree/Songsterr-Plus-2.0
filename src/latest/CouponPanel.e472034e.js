import{d as t,e as e,a as o}from"./preact.3d326435.js";import{w as a,R as s,bG as n,cr as r,k as i,Q as c,L as l,f as u,T as p}from"./index.c64a48b4.js";import{I as h}from"./Input.33ac2f73.js";import{A as d}from"./ActionButton.3cab06c5.js";import{S as m,C as f}from"./ContinueLink.2fedf097.js";import{P as v}from"./Panel.7e25754f.js";import{_ as y}from"./GenericPanel.module.67ac8ae5.js";var de=null,es=null,fr=null,it=null,ja=null,ko=null,pt=null,ru=null,zh=null,locales=[de,es,fr,it,ja,ko,pt,ru,zh];class CouponPanel extends t{coupon=e();constructor(t){super(t),this.state={error:null,processing:!1,next:!1}}activate=async()=>{let t=this.coupon.current;try{s([{field:t,validator:n}]),this.setState({processing:!0,error:null});let e=await r(t.value);this.props.dispatch("user/profile",e),this.props.dispatch("curiosity/conversion",{event:"Activated coupon",Coupon:t.value}),this.props.dispatch("curiosity/google",{category:"Subscription",action:"Activated coupon"}),this.setState({processing:!1,error:null,next:!0})}catch(t){this.setState({processing:!1,error:t})}};handleSubmit=async t=>{t.preventDefault(),await this.activate()};componentDidMount(){this.coupon.current&&this.coupon.current.value&&this.activate()}render(){let{gettext:t}=i(locales),e=o(m,{key:"form",className:y.section,"data-section":"coupon"},o("h4",{className:y.title},t("Please enter coupon.")),o("form",{noValidate:!0,onSubmit:this.handleSubmit,action:""},o(c,{error:this.state.error}),o(h,{type:"text",label:t("Coupon"),name:"coupon",ref:this.coupon,error:this.state.error,autocomplete:"coupon",defaultValue:this.props.query.code||""}),o("div",{className:y.actions},o(d,{title:t("Activate"),processing:this.state.processing}),o(l,{to:"/a/wa/account",className:u.buttonLinkFloat},"Cancel")))),a=o(m,{key:"done",className:y.section,"data-section":"done"},o("h4",{className:y.title},t("The coupon has been successfully applied.")),o(f,{href:"/a/wa/account"},t("Start rockin'"))),s=this.state.next?a:e;return o(v,{id:"activate-coupon",title:t("Activate coupon")},o(p,null,s))}}var CouponPanel$1=a(CouponPanel,"user");export{CouponPanel$1 as default};
