import{d as t,e as e,a as a}from"./preact.bf58aca5.js";import{w as o,R as s,bJ as n,ct as r,k as i,Q as c,L as l,f as u,T as p}from"./index.e8b15340.js";import{I as h}from"./Input.bba300bf.js";import{A as m}from"./ActionButton.45f3bd1f.js";import{S as d,C as f}from"./ContinueLink.9b697552.js";import{P as v}from"./Panel.98ba2c65.js";import{_ as b}from"./GenericPanel.module.67ac8ae5.js";var de=null,es=null,fr=null,it=null,ja=null,ko=null,pt=null,ru=null,zh=null,locales=[de,es,fr,it,ja,ko,pt,ru,zh];class CouponPanel extends t{coupon=e();constructor(t){super(t),this.state={error:null,processing:!1,next:!1}}activate=async()=>{let t=this.coupon.current;try{s([{field:t,validator:n}]),this.setState({processing:!0,error:null});let e=await r(t.value);this.props.dispatch("user/profile",e),this.props.dispatch("curiosity/conversion",{event:"Activated coupon",Coupon:t.value}),this.props.dispatch("curiosity/google",{category:"Subscription",action:"Activated coupon"}),this.setState({processing:!1,error:null,next:!0})}catch(a){this.setState({processing:!1,error:a})}};handleSubmit=async t=>{t.preventDefault(),await this.activate()};componentDidMount(){this.coupon.current&&this.coupon.current.value&&this.activate()}render(){let{gettext:t}=i(locales),e=a(d,{key:"form",className:b.section,"data-section":"coupon"},a("h4",{className:b.title},t("Please enter coupon.")),a("form",{noValidate:!0,onSubmit:this.handleSubmit,action:""},a(c,{error:this.state.error}),a(h,{type:"text",label:t("Coupon"),name:"coupon",ref:this.coupon,error:this.state.error,autocomplete:"coupon",defaultValue:this.props.query.code||""}),a("div",{className:b.actions},a(m,{title:t("Activate"),processing:this.state.processing}),a(l,{to:"/a/wa/account",className:u.buttonLinkFloat},"Cancel")))),o=a(d,{key:"done",className:b.section,"data-section":"done"},a("h4",{className:b.title},t("The coupon has been successfully applied.")),a(f,{href:"/a/wa/account"},t("Start rockin'"))),s=this.state.next?o:e;return a(v,{id:"activate-coupon",title:t("Activate coupon")},a(p,null,s))}}var CouponPanel$1=o(CouponPanel,"user");export{CouponPanel$1 as default};
