import{g as e,i as s,j as t,A as a,v as o,m as i,f as r,d as n}from"./preact.f8a34c73.js";import{a3 as l,c8 as c,c9 as u,_ as m,u as p,L as d,a7 as f,p as v,q as g,c6 as b,c7 as h,J as k,ca as N,cb as w}from"./index.3637aaf7.js";import{w as y}from"./FileInput.6e253ba2.js";import{d as C,B as I}from"./Input.4b13d914.js";import{_ as S,x,p as j,v as D,c as L}from"./FormError.ba736668.js";import{n as H}from"./ActionButton.e7edc72b.js";import{s as A,r as O,n as B}from"./Linkify.1f80d776.js";import{y as E,d as R}from"./user.804c31aa.js";const W={motto:"Cuf1ge",actions:"Cuf6b",notes:"Cuf7x",notesWarning:"Cuf7x Cuf2sa",field:I+" Cuf13f",textarea:"Cuf8p"},G={content:O+" B9j34t"},M=Object.assign({},A,G),P=e=>{let{meta:t,actions:r}=e;const{dispatch:n,user:c}=p("user"),u=s(),d=s(),f=c.isAdmin,v=f?".gp3, .gp4, .gp5, .gpx, .gp":".gp3, .gp4, .gp5",[g,k]=i(!1),[N,w]=i(null),[I,S]=i(null),[O,B]=i(null),E=a((e=>{e.preventDefault();const s=new l;return(async(e,s,a,o)=>{k(!0),w(null);try{const i=j(f);D([{field:e,validator:L},{field:s,validator:i}]);const r={file:s.files[0],summary:e.value,songId:t.songId.toString(),force:a};await b(n,r,o),B(null)}catch(e){e instanceof h?(S(!0),B(e)):(S(!1),w(e))}k(!1)})(d.current,u.current,I,s.signal),s.abort.bind(s)}),[d,u,I]),R=t.tracks&&t.tracks.length>2;return o("form",{noValidate:!0,className:W.form,onSubmit:E,action:""},o(x,{styles:A,error:N}),o("p",{className:W.motto,"aria-label":"motto"},"Download the latest revision from the list below, make your edits,",o("br",null),"save the result and upload it using the form below.",R&&o("span",{role:"warning"},o("br",null),"Please make sure to keep all the tracks in the resulting file.")),o(y,{id:"revisionFile",accept:v,label:"Upload your .gp5 file",ref:u,name:"file",error:O||N,popup:!0,errorStyles:O?M:A,isDropFileAvailable:!0,isNewFormats:f}),o("p",{className:W.notes,role:"instructions"},"To edit a tab you'll need to either buy ",o("a",{href:"https://www.guitar-pro.com/en/index.php",rel:"noopener noreferrer",target:"_blank"},"Guitar Pro")," software or",o("br",null),"use a free ",o("a",{href:"https://sourceforge.net/projects/tuxguitar",rel:"noopener noreferrer",target:"_blank"},"TuxGuitar")," alternative."),o("p",{className:W.notes,role:"instructions"},"We only support Guitar Pro 3, 4, and 5 files at the moment.",o("br",null),"If you have a Guitar Pro 6/7+ (.gpx, .gp) file, please export it to a Guitar Pro 5 file format first.",o("br",null),o("a",{href:"https://www.guitar-pro.com/en/index.php",rel:"noopener noreferrer",target:"_blank"},"Guitar Pro"),": File → Export → GP5",o("br",null),o("a",{href:"https://sourceforge.net/projects/tuxguitar",rel:"noopener noreferrer",target:"_blank"},"TuxGuitar"),": File → Save As → Guitar Pro 5"),o(C,{ref:d,name:"summary",type:"textarea",error:N,placeholder:"Briefly explain your changes (fixed errors, replaces with whole new version, corrected tempo, etc)",styles:W,errorStyles:A,popup:!0}),o("div",{className:W.actions},o("a",{className:m.popupButtonLinkGreen,onClick:r.back},"Cancel"),o(H,{id:O?"submitRevisionButtonWarning":"submitRevisionButton",title:I?"Submit anyway":"Submit revision",processing:g})),o("p",{className:W.notes},"Once processing is complete, we'll send you an email notification,",o("br",null),"and the site will display the new revision."))},F={section:"w31p8",current:"w3261",currentText:"w3dp",options:"w3a5",reason:"w31q",text:"w3n5",textarea:"w32aw",title:"w3s9",notes:"w31we",actions:"w31fb"};function _(e,s){switch(s.type){case"enable":return Object.assign({},e,{form:!0});case"toggle":return Object.assign({},e,{reason:s.kind});case"submit":return Object.assign({},e,{processing:!0,error:null});case"success":return Object.assign({},e,{processing:!1,success:!0});case"failure":return Object.assign({},e,{processing:!1,error:s.error})}}const T=e((e=>{let{meta:i,actions:r}=e;const n=s(),[p,d]=t(_,{form:!1,processing:!1,error:null,reason:null,message:null,success:!1}),f=a((e=>{e.preventDefault();const s=new l;return(async(e,s,t,a)=>{d({type:"submit"});try{S(s,t);const o={songId:e.songId,revisionId:e.revisionId,kind:s,summary:t};await E(o,a),function(e){const s=c("revisionReports")||[];s.push(e),u("revisionReports",s)}(e.revisionId),d({type:"success"}),setTimeout(r.success,0)}catch(e){d({type:"failure",error:e})}})(i,p.reason,n.current.value,s.signal),s.abort.bind(s)}),[p,i]);return p.success?o("section",{className:F.section,"data-section":"report"},o("p",null,"Your report has been sent."),o("p",{className:F.notes},"We'll review your report as soon as possible. ",o("br",null),"And will roll back the revision in case of a problem."),o("div",{className:F.actions},o("a",{className:m.popupButtonOrange,onClick:r.back},"OK"))):o("section",{className:F.section,"data-section":"report"},o("form",{noValidate:!0,className:F.form,onSubmit:f,action:""},o(x,{styles:A,error:p.error}),o("p",{className:F.title},"Do you think that the new revision made the tab worse? If so, please tell us why:"),o("ul",{className:F.options},Object.keys(R).map((e=>o("li",{key:e,className:F.reason,onClick:()=>d({type:"toggle",kind:e})},o("input",{type:"radio",name:"reason",checked:p.reason===e,value:e}),o("label",{className:F.text},R[e]))))),o(C,{ref:n,name:"comment",type:"textarea",error:p.error,placeholder:"Provide additional details on problematic tracks, measures, notes, etc.",styles:F,errorStyles:A,popup:!0}),o("div",{className:F.actions},o("a",{className:m.popupButtonLinkOrange,onClick:r.back},"Cancel"),o(H,{id:"submitReportButton",title:"Report",processing:p.processing})),o("p",{className:F.notes},"We'll review your report as soon as possible. ",o("br",null),"And will roll back the revision in case of a problem.")))}));function z(){return o("svg",{width:15,height:8,viewBox:"0 0 15 8"},o("path",{d:"M8 2.9a1.1 1.1 0 0 0 0 2.2 1.1 1.1 0 0 0 0-2.2zm0 4a2.9 2.9 0 0 1 0-5.8 2.9 2.9 0 0 1 0 5.8zM14.5 3C13.2 2 10.9.3 8 .3S2.8 2 1.5 3c-.9.6-.9 1.4 0 2C2.8 6 5.1 7.7 8 7.7S13.2 6 14.5 5c.9-.6.9-1.4 0-2z"}))}function U(){return o("svg",{width:8,height:8,viewBox:"0 0 8 8"},o("path",{d:"M7.45 4.71 6.17 2.67 7.46.61c.02-.04.03-.1 0-.14A.139.139 0 0 0 7.34.4H1.88V.13c0-.07-.31-.13-.39-.13-.07 0-.41.06-.41.13v7.73c0 .08.36.13.43.13.08 0 .46-.04.46-.12V4.93h5.38c.07 0 .13-.06.13-.13 0-.03-.02-.06-.03-.09z"}))}function V(){return o("svg",{width:8,height:8,viewBox:"0 0 8 8"},o("path",{d:"M6 0H2v4H0l4 4L8 4H6V0z"}))}const $={item:"C7k1rh",itemActive:"C7k1rh C7kks",itemInvalid:"C7k1rh C7k2yw",message:"C7k2fj",itemInvalidActive:"C7k1rh C7k2yw C7k22w",meta:"C7krn",person:"C7k23d",adminLinks:"C7kl6",adminLink:"C7k7o",metaLinks:"C7k2a1",link:"C7kwj",actionLink:"C7k7t",disabledLink:"C7k29n",linkActive:"C7kv8"},q=e=>{let{revision:s,meta:t,user:a,partId:i,reportAction:r,processing:n}=e;const l=!s.tracks,u=s.revisionId===t.revisionId,m=s.tracks?Math.min(s.tracks-1,i):0,p=k(t,m,s.revisionId),f=new Date(s.date).toLocaleDateString(),v=(g=s.revisionId,(c("revisionReports")||[]).includes(g));var g;const b=N("deleteRevision",s.revisionId),h=N("editRevision",s.revisionId),y=w("Revision",s.revisionId),C=a.isAdmin&&o("span",{className:$.adminLinks},o("a",{className:$.adminLink,href:h,target:"_blank"},"edit"),o("a",{className:$.adminLink,href:b,target:"_blank"},"delete"),s.isBlocked&&o("a",{className:$.adminLink,href:y},"unblock")),I={className:$.actionLink,to:p,"aria-label":"action"},S={className:$.linkActive,href:s.source,"aria-label":"download",download:!0,target:"_blank"},x=o("span",{className:$.metaLinks},!u&&o(d,I,o(z,null)," view"),u&&r&&o("a",{className:v?$.disabledLink:$.linkActive,onClick:v?null:r},o(U,null),v?" reported":" report"),u&&a.isLoggedIn&&o("a",S,o(V,null)," download"));let j;return j=l||s.isBlocked?u?$.itemInvalidActive:$.itemInvalid:u?$.itemActive:$.item,o("li",{key:s.revisionId,className:j},o(B,{styles:$},`${s.isBlocked?"Blocked: ":""}${s.summary}`),o("p",{className:$.meta},`${f} – by `,o("span",{className:$.person},s.person),C,!l&&!n&&x))},J={scroller:"Cca1wi",spinner:"Cca13w",title:"Ccahc",content:"Cca1mk",section:"Cca34p",sectionForm:"Cca1z3",actions:"Ccame",motto:"Cca1lf",subMotto:"Cca1lf Cca1gp",auth:"Cca2yf",authReport:"Cca2yf Cca2uj",list:"Cca1p3"};var K,Y,Q;(Q=K||(K={}))[Q.HIDDEN=0]="HIDDEN",Q[Q.SHOWN=1]="SHOWN",function(e){e[e.HIDDEN=0]="HIDDEN",e[e.SHOWN=1]="SHOWN",e[e.SUCCESS=2]="SUCCESS"}(Y||(Y={}));const X=e=>{let{style:t,setStyle:l}=e;const{user:c,revisions:u,uploads:b,meta:h,screen:k}=p("user","revisions","uploads","meta","screen"),{isLoggedIn:N,isAdmin:w}=c,{isLoading:y}=u,{revision:C,revisionError:I,revisionSubmitted:S}=b,[x,j]=i(K.HIDDEN),[D,L]=i(Y.HIDDEN),H=s(),A=s(),O=D?"Report revision":"Revisions";r((()=>{const e=A.current.scrollHeight,s=(a=k.viewport.height,{height:a-76}).height;var a;const o=Object.assign({},t,{height:Math.min(e+107,s)});t.height!==o.height&&l(o)}),[k,A,u,C,b,D,x]);const B=N&&C&&!I,E=N&&C&&C.songId!==h.songId,R=E?`${C.artist} – ${C.title}`:"",W={success:()=>L(Y.SUCCESS),back:()=>L(Y.HIDDEN)},G={back:()=>j(K.HIDDEN)},M=o("section",{className:J.section,"data-section":"welcome"},o("p",{className:J.motto},"Have a better tab for this song?"),o("p",{className:J.motto},"Care to fix the current tab?"),o("p",{className:J.subMotto},"Submit your corrections for everyone to enjoy!"),o("div",{className:J.auth,"aria-label":"auth"},"Please ",o(d,{"data-link":"signin",to:"/a/wa/signin"},"sign up")," for free to submit a new revision.")),F=o("section",{className:J.sectionForm,"data-section":"submit"},o("p",{className:J.motto},"Have a better tab for this song?"),o("p",{className:J.motto},"Care to fix the current tab?"),o("p",{className:J.subMotto},"Submit your corrections for everyone to enjoy!"),o("div",{className:J.actions},o("a",{id:"submit-revision-button",className:m.popupButtonGreen,onClick:()=>j(K.SHOWN)},"Submit a new revision"))),_=o("section",{className:J.sectionForm,"data-section":"submit"},o(P,{meta:h.current,actions:G})),z=o("section",{className:J.section,"data-section":"duplicate"},o("p",{className:J.motto,"aria-label":"motto"},"Submitted version already exists on Songsterr."),!E&&o("p",{className:J.subMotto,"aria-label":"info"},"Uploaded file looks exactly like the latest version of this song."),E&&o("div",null,o("p",{className:J.subMotto,"aria-label":"info"},"Uploaded file looks like duplicate of ",o("br",null),o(d,{to:f(C),"data-link":"duplicate"},R)))),U=o("section",{className:J.section,"data-section":"success"},o("div",null,o("p",{className:J.motto},"Thanks for contributing to Songsterr!"),o("p",{className:J.mottoInverse},"We are processing the file and will redirect to a new revision as soon as possible."),o("div",null,o(v,{fill:"#fefefe",width:30,height:30})))),V=a(((e,s)=>1===e.length||0!==s?{reportAction:null}:{reportAction:()=>{H.current&&(H.current.scrollTop=0),D||L(Y.SHOWN)}}),[H,D]),$=o("section",{"data-section":"revisions"},o("ul",{className:J.list},u.revisions&&h.current&&u.revisions.map(((e,s)=>o(q,Object.assign({revision:e,meta:h.current,user:{isLoggedIn:N,isAdmin:w},partId:h.partId,key:e.revisionId,processing:S},V(u.revisions,s))))))),Q=!N&&!D,X=N&&!B&&!D&&!x,Z=N&&!B&&!D&&!!x,ee=B&&!D&&!S,se=B&&!D&&S;return o(n,{},o("h3",{className:J.title},O),o("div",{className:J.scroller,ref:H},o("div",{className:J.content,ref:A},Q&&M,X&&F,Z&&_,ee&&z,se&&U,N&&!!D&&o(T,{meta:h.current,actions:W}),!N&&!!D&&o("section",{className:J.section,"data-section":"welcome"},o("div",{className:J.authReport,"aria-label":"auth"},"Please ",o(d,{"data-link":"signin",to:"/a/wa/signin"},"sign up")," for free to report issues."),o("a",{className:m.popupButtonLinkOrange,onClick:()=>L(0)},"Back to revisions")),y&&!D&&o("div",{className:J.spinner},o(v,{className:g.revisions,width:25,height:24,fill:"#f7f6ee"})),!y&&!D&&$)))};export{X as default};
//# sourceMappingURL=RevisionsPopupContent.8e81935d.js.map
